##### 1ã€jdk

###### 1.1 join

```java
import java.util.*;

public class WebsiteStatsCollector {

    // æ¨¡æ‹Ÿç»“æœå®¹å™¨ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    private static final Map<String, Integer> resultMap = Collections.synchronizedMap(new HashMap<>());

    public static void main(String[] args) throws InterruptedException {
        // è¦æŠ“å–çš„ç½‘ç«™åˆ—è¡¨
        List<String> websites = Arrays.asList("siteA.com", "siteB.com", "siteC.com");

        // å­˜æ”¾çº¿ç¨‹å¯¹è±¡
        List<Thread> threads = new ArrayList<>();

        // ä¸ºæ¯ä¸ªç½‘ç«™å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹
        for (String site : websites) {
            Thread thread = new Thread(() -> {
                int visitCount = fetchVisitCount(site);
                resultMap.put(site, visitCount);
                System.out.println(site + " æ•°æ®æ”¶é›†å®Œæˆï¼Œè®¿é—®é‡ï¼š" + visitCount);
            });

            thread.start();
            threads.add(thread);
        }

        // ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å®Œæˆ
        for (Thread t : threads) {
            t.join();  // é˜»å¡ç­‰å¾…
        }

        // æ‰€æœ‰å­çº¿ç¨‹å®Œæˆï¼Œè¿›è¡Œç»“æœæ±‡æ€»
        System.out.println("\nğŸ“Š æ‰€æœ‰ç½‘ç«™è®¿é—®é‡ç»Ÿè®¡ï¼š");
        resultMap.forEach((site, count) -> System.out.println(site + ": " + count));
    }

    // æ¨¡æ‹ŸæŠ“å–æ–¹æ³•ï¼ˆéšæœºç”Ÿæˆè®¿é—®é‡ + ç¡çœ æ¨¡æ‹Ÿå»¶è¿Ÿï¼‰
    private static int fetchVisitCount(String site) {
        try {
            Thread.sleep((int)(Math.random() * 3000)); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return new Random().nextInt(10000); // æ¨¡æ‹Ÿè®¿é—®é‡
    }
}

```





###### 1.2 Futureæ¥å£ã€FutureTaskç±»

```java
package com.crazymakercircle.coccurent;
//...
public class JavaFutureDemo {
    public static final int SLEEP_GAP = 500;
    public static String getCurThreadName() {
        return Thread.currentThread().getName();
    } 
    static class HotWarterJob implements Callable<Boolean> //â‘ 
    {
        @Override
        public Boolean call() throws Exception //â‘¡
        {
            try {
                Logger.infoï¼ˆ"æ´—å¥½æ°´å£¶"ï¼‰;
                Logger.infoï¼ˆ"çŒä¸Šå‡‰æ°´"ï¼‰;
                Logger.infoï¼ˆ"æ”¾åœ¨ç«ä¸Š"ï¼‰;
                //çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œä»£è¡¨çƒ§æ°´ä¸­
                Thread.sleep(SLEEP_GAP);
                Logger.infoï¼ˆ"æ°´å¼€äº†"ï¼‰;
            } catch (InterruptedException e) {
                Logger.infoï¼ˆ" å‘ç”Ÿå¼‚å¸¸è¢«ä¸­æ–­."ï¼‰;
                return false;
            }
            Logger.infoï¼ˆ" è¿è¡Œç»“æŸ."ï¼‰;
            return true;
        }
    }
    static class WashJob implements Callable<Boolean> {
        @Override
        public Boolean call() throws Exception {
            try {
                Logger.infoï¼ˆ"æ´—èŒ¶å£¶"ï¼‰;
                Logger.infoï¼ˆ"æ´—èŒ¶æ¯"ï¼‰;
                Logger.infoï¼ˆ"æ‹¿èŒ¶å¶"ï¼‰;
                //çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œä»£è¡¨æ¸…æ´—ä¸­
                Thread.sleep(SLEEP_GAP);
                Logger.infoï¼ˆ"æ´—å®Œäº†"ï¼‰;
            } catch (InterruptedException e) {
                Logger.infoï¼ˆ" æ¸…æ´—å·¥ä½œå‘ç”Ÿå¼‚å¸¸è¢«ä¸­æ–­."ï¼‰;
                return false;
            }
            Logger.infoï¼ˆ" æ¸…æ´—å·¥ä½œè¿è¡Œç»“æŸ."ï¼‰;
            return true;
        }
    }
    public static void drinkTea(booleanwarterOk, booleancupOk) {
        if (warterOk&&cupOk) {
            Logger.infoï¼ˆ"æ³¡èŒ¶å–"ï¼‰;
        } else if (!warterOk) {
            Logger.infoï¼ˆ"çƒ§æ°´å¤±è´¥ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
        } else if (!cupOk) {
            Logger.infoï¼ˆ"æ¯å­æ´—ä¸äº†ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
        }
    }
    public static void main(String args[]) {
        Callable<Boolean>hJob = new HotWarterJob();//â‘¢
        FutureTask<Boolean>hTask = new FutureTask<>(hJob);//â‘£
        Thread hThread = new Threadï¼ˆhTask, "** çƒ§æ°´-Thread"ï¼‰;//â‘¤
        Callable<Boolean>wJob = new WashJob();//â‘¢
        FutureTask<Boolean>wTask = new FutureTask<>(wJob);//â‘£
        Thread wThread = new Threadï¼ˆwTask, "$$ æ¸…æ´—-Thread"ï¼‰;//â‘¤
        hThread.start();
        wThread.start();
        Thread.currentThread().setNameï¼ˆ"ä¸»çº¿ç¨‹"ï¼‰;
            try {
                booleanwarterOk = hTask.get();
                booleancupOk = wTask.get();
                drinkTea(warterOk, cupOk);
            } catch (InterruptedException e) {
                Logger.info(getCurThreadName() + "å‘ç”Ÿå¼‚å¸¸è¢«ä¸­æ–­.");
            } catch (ExecutionException e) {
                e.printStackTrace();
            }
        Logger.info(getCurThreadName() + " è¿è¡Œç»“æŸ.");
    }
}
```



##### 2ã€Guava

FutureCallbackã€ListenableFuture

```java
package com.crazymakercircle.coccurent;
//â€¦.
public class GuavaFutureDemo {
    public static final int SLEEP_GAP = 500;
    public static String getCurThreadName() {
        return Thread.currentThread().getName();
    }
    //ä¸šåŠ¡é€»è¾‘ï¼šçƒ§æ°´
    static class HotWarterJob implements Callable<Boolean>
    {
        @Override
        public Boolean call() throws Exception 
        {
            //â€¦â€¦çœç•¥ï¼Œä¸ä½¿ç”¨FutureTaskå®ç°å¼‚æ­¥æ³¡èŒ¶å–ç›¸åŒ
        }
    }
    //ä¸šåŠ¡é€»è¾‘ï¼šæ¸…æ´—
    static class WashJob implements Callable<Boolean> {
        @Override
        public Boolean call() throws Exception {
            //â€¦â€¦çœç•¥ï¼Œä¸ä½¿ç”¨FutureTaskå®ç°å¼‚æ­¥æ³¡èŒ¶å–ç›¸åŒ
        }
    }
    //æ–°åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä¸šåŠ¡ç±»å‹ï¼Œä½œä¸ºæ³¡èŒ¶å–ä¸»çº¿ç¨‹ç±»
    static class MainJob implements Runnable {
    booleanwarterOk = false;
    booleancupOk = false;
        int gap = SLEEP_GAP / 10;
        @Override
        public void run() {
            while (true) {
                try {
                    Thread.sleep(gap);
                    Logger.infoï¼ˆ"è¯»ä¹¦ä¸­......"ï¼‰;
                } catch (InterruptedException e) {
                    Logger.info(getCurThreadName() + "å‘ç”Ÿå¼‚å¸¸è¢«ä¸­æ–­.");
                }
                if (warterOk&&cupOk) {
                    drinkTea(warterOk, cupOk);
                }
            }
        }
        public void drinkTea(Boolean wOk, Boolean cOK) {
            if (wOk&&cOK) {
                Logger.infoï¼ˆ"æ³¡èŒ¶å–ï¼ŒèŒ¶å–å®Œ"ï¼‰;
                this.warterOk = false;
                this.gap = SLEEP_GAP * 100;
            } else if (!wOk) {
                Logger.infoï¼ˆ"çƒ§æ°´å¤±è´¥ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
            } else if (!cOK) {
                Logger.infoï¼ˆ"æ¯å­æ´—ä¸äº†ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
            }
        }
    }
    public static void main(String args[]) {
        //åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å®ä¾‹ï¼Œä½œä¸ºæ³¡èŒ¶ä¸»çº¿ç¨‹
        MainJobmainJob = new MainJob();
        Thread mainThread = new Thread(mainJob);
        mainThread.setNameï¼ˆ"ä¸»çº¿ç¨‹"ï¼‰;
        mainThread.start();
        //çƒ§æ°´çš„ä¸šåŠ¡é€»è¾‘å®ä¾‹
        Callable<Boolean>hotJob = new HotWarterJob();
        //æ¸…æ´—çš„ä¸šåŠ¡é€»è¾‘å®ä¾‹
        Callable<Boolean>washJob = new WashJob();
        //åˆ›å»ºJava çº¿ç¨‹æ± 
        ExecutorServicejPool = Executors.newFixedThreadPool(10);
        //åŒ…è£…Javaçº¿ç¨‹æ± ï¼Œæ„é€ Guava çº¿ç¨‹æ± 
        ListeningExecutorServicegPool 
                         = MoreExecutors.listeningDecorator(jPool);
        //æäº¤çƒ§æ°´çš„ä¸šåŠ¡é€»è¾‘å®ä¾‹ï¼Œåˆ°Guavaçº¿ç¨‹æ± è·å–å¼‚æ­¥ä»»åŠ¡
        ListenableFuture<Boolean>hotFuture = gPool.submit(hotJob);
        //ç»‘å®šå¼‚æ­¥å›è°ƒï¼Œçƒ§æ°´å®Œæˆåï¼ŒæŠŠå–æ°´ä»»åŠ¡çš„warterOkæ ‡å¿—è®¾ç½®ä¸ºtrue
        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {
            public void onSuccess(Boolean r) {
                if (r) {
                    mainJob.warterOk = true;
                }
            }
            public void onFailure(Throwable t) {
                Logger.infoï¼ˆ"çƒ§æ°´å¤±è´¥ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
            }
        };
        //æäº¤æ¸…æ´—çš„ä¸šåŠ¡é€»è¾‘å®ä¾‹ï¼Œåˆ°Guavaçº¿ç¨‹æ± è·å–å¼‚æ­¥ä»»åŠ¡
        ListenableFuture<Boolean>washFuture = gPool.submit(washJob);
        //ç»‘å®šä»»åŠ¡æ‰§è¡Œå®Œæˆåçš„å›è°ƒé€»è¾‘åˆ°å¼‚æ­¥ä»»åŠ¡
        Futures.addCallback(washFuture, new FutureCallback<Boolean>() {
            public void onSuccess(Boolean r) {
                if (r) {
                    mainJob.cupOk = true;
                }
            }
            public void onFailure(Throwable t) {
                Logger.infoï¼ˆ"æ¯å­æ´—ä¸äº†ï¼Œæ²¡æœ‰èŒ¶å–äº†"ï¼‰;
            }
        });
    }
}
```





























